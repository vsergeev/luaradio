<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>LuaRadio - SSB Receiver Example</title>
  
  <meta name="author" content="Vanya A. Sergeev" />
  <meta name="description" content="LuaRadio" />
  <link rel="canonical" href="https://luaradio.io/examples/rtlsdr-ssb.html" />
  <link rel="icon" type="image/x-icon" href="../favicon.ico" />

  <link rel="stylesheet" href="../assets/css/all.css">
  <script type="text/javascript" src="../assets/js/tocbot.min.js"></script>
  <script type="text/javascript" src="../assets/js/toc.js"></script>

  
  
</head>
<body id="top">
  <div class="container">
    <div class="row">
      <div class="three columns sidebar">
        <nav class="menu">
  <h1 class="title"><a href="..">LuaRadio</a></h1>
  <div class="links">
      <a href="https://github.com/vsergeev/luaradio/blob/master/CHANGELOG.md"><i class="fa fa-link fa-fw" aria-hidden="true"></i> <code class="version">v0.8.0</code></a><br />
      <a href="https://github.com/vsergeev/luaradio"><i class="fa fa-github fa-fw" aria-hidden="true"></i> GitHub</a><br />
      <a href="https://groups.io/g/luaradio"><i class="fa fa-envelope fa-fw" aria-hidden="true"></i> Mailing List</a>
  </div>
  <div class="toc">
    <ul>
        <li><a href="../new-to-sdr.html">New to SDR?</a></li>
        <li><a href="../docs/">Documentation</a>
            <ul>
                <li><a href="../docs/installation.html">Installation</a></li>
                <li><a href="../docs/getting-started.html">Getting Started</a></li>
                <li><a href="../docs/creating-blocks.html">Creating Blocks</a></li>
                <li><a href="../docs/embedding-luaradio.html">Embedding LuaRadio</a></li>
                <li><a href="../docs/architecture.html">Architecture</a></li>
                <li><a href="../docs/comparison-gnuradio.html">Comparison to GNU Radio</a></li>
                <li><a href="../docs/supported-hardware.html">Supported Hardware</a></li>
            </ul>
        </li>
        <li><a href="../docs/reference-manual.html">Reference Manual</a></li>
        <li><a href="https://github.com/vsergeev/luaradio/wiki#project-roadmap">Project Roadmap</a></li>
        <li><a href="../examples/">Examples</a>
            <ul>
                <li><a href="../examples/rtlsdr-wbfm-mono.html">WBFM Mono</a></li>
                <li><a href="../examples/rtlsdr-wbfm-stereo.html">WBFM Stereo</a></li>
                <li><a href="../examples/rtlsdr-nbfm.html">NBFM</a></li>
                <li><a href="../examples/rtlsdr-ax25.html">AX.25</a></li>
                <li><a href="../examples/rtlsdr-pocsag.html">POCSAG</a></li>
                <li><a href="../examples/rtlsdr-rds.html">RDS</a></li>
                <li><a href="../examples/rtlsdr-am-envelope.html">AM (Envelope)</a></li>
                <li><a href="../examples/rtlsdr-am-synchronous.html">AM (Synchronous)</a></li>
                <li><a href="../examples/rtlsdr-ssb.html">SSB</a></li>
                <li><a href="../examples/wavfile-ssb-modulator.html">WAV SSB Modulator</a></li>
                <li><a href="../examples/iqfile-converter.html">IQ File Converter</a></li>
            </ul>
        </li>
        <li><a href="../benchmarks.html">Benchmarks</a></li>
    </ul>
  </div>
  <p align="center">
    <a style="font-size: 1.4rem;" href="mailto:v@sergeev.io"><i class="fa fa-envelope-o" aria-hidden="true"></i> v@sergeev.io</a>
  </p>
</nav>

        <nav class="scroll-toc">
  <div class="toc-header">
    <h1 class="title"><a data-scroll href="#top">LuaRadio</a></h1>
    <div class="links">
      <a href="https://github.com/vsergeev/luaradio/blob/master/CHANGELOG.md"><i class="fa fa-link fa-fw" aria-hidden="true"></i> <code class="version">v0.8.0</code></a><br />
      <a href="https://github.com/vsergeev/luaradio"><i class="fa fa-github fa-fw" aria-hidden="true"></i> GitHub</a><br />
      <a href="https://groups.io/g/luaradio"><i class="fa fa-envelope fa-fw" aria-hidden="true"></i> Mailing List</a>
    </div>
  </div>
  <div class="toc">
    <span class="page-title"><a data-scroll href="#top">SSB Receiver Example</a></span>
    <div class="js-toc">
    </div>
  </div>
</nav>

      </div>
      <div class="nine columns content">
        <h1 id="rtlsdr_ssblua"><a href="https://github.com/vsergeev/luaradio/blob/master/examples/rtlsdr_ssb.lua"><code class="language-plaintext highlighter-rouge">rtlsdr_ssb.lua</code></a></h1>

<p>This example is a
<a href="https://en.wikipedia.org/wiki/Single-sideband_modulation">Single-Sideband</a>
(SSB) AM radio receiver. SSB is commonly used by amateur radio operators on the
HF band, and sometimes on the VHF and UHF bands, for voice and digital
(modulated in the audio) communication. This example uses the RTL-SDR as an SDR
source, plays audio with PulseAudio, and shows two real-time plots: the RF
spectrum and the demodulated audio spectrum.</p>

<p>This example requires an RF upconverter to listen to stations on the HF and MF
bands with the RTL-SDR.</p>

<p>This single-sideband demodulator composition is available in LuaRadio as the
<a href="../docs/reference-manual.html#ssbdemodulator"><code class="language-plaintext highlighter-rouge">SSBDemodulator</code></a> block.</p>

<p align="center">
<a href="../images/screenshot-rtlsdr_ssb.png" target="_blank"><img src="../images/screenshot-rtlsdr_ssb-thumb.png" style="display: inline-block; vertical-align: middle;" /></a>
<a href="https://asciinema.org/a/d9hjdi657t5i64cmonfhafnh5" target="_blank"><img src="../images/asciinema-rtlsdr_ssb-thumb.png" style="display: inline-block; vertical-align: middle;" /></a>
</p>

<h5 id="flow-graph">Flow Graph</h5>

<p align="center">
<img src="../docs/figures/flowgraph_rtlsdr_ssb.png" />
</p>

<h5 id="source">Source</h5>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">radio</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'radio'</span><span class="p">)</span>

<span class="k">if</span> <span class="o">#</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">then</span>
    <span class="nb">io.stderr</span><span class="p">:</span><span class="n">write</span><span class="p">(</span><span class="s2">"Usage: "</span> <span class="o">..</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">..</span> <span class="s2">" &lt;frequency&gt; &lt;sideband&gt;\n"</span><span class="p">)</span>
    <span class="nb">os.exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">assert</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"usb"</span> <span class="ow">or</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"lsb"</span><span class="p">,</span> <span class="s2">"Sideband should be 'lsb' or 'usb'."</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">frequency</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="kd">local</span> <span class="n">sideband</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="kd">local</span> <span class="n">tune_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100e3</span>
<span class="kd">local</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="mf">3e3</span>

<span class="c1">-- Blocks</span>
<span class="kd">local</span> <span class="n">source</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">RtlSdrSource</span><span class="p">(</span><span class="n">frequency</span> <span class="o">+</span> <span class="n">tune_offset</span><span class="p">,</span> <span class="mi">1102500</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">tuner</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">TunerBlock</span><span class="p">(</span><span class="n">tune_offset</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">bandwidth</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">sb_filter</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">ComplexBandpassFilterBlock</span><span class="p">(</span><span class="mi">129</span><span class="p">,</span> <span class="p">(</span><span class="n">sideband</span> <span class="o">==</span> <span class="s2">"lsb"</span><span class="p">)</span> <span class="ow">and</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">bandwidth</span><span class="p">}</span>
                                                                             <span class="ow">or</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">})</span>
<span class="kd">local</span> <span class="n">am_demod</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">ComplexToRealBlock</span><span class="p">()</span>
<span class="kd">local</span> <span class="n">af_filter</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">LowpassFilterBlock</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">af_gain</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">AGCBlock</span><span class="p">(</span><span class="s1">'fast'</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">sink</span> <span class="o">=</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s1">'DISPLAY'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">radio</span><span class="p">.</span><span class="n">PulseAudioSink</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">radio</span><span class="p">.</span><span class="n">WAVFileSink</span><span class="p">(</span><span class="s1">'ssb.wav'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">-- Plotting sinks</span>
<span class="kd">local</span> <span class="n">plot1</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">GnuplotSpectrumSink</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="s1">'RF Spectrum'</span><span class="p">,</span> <span class="p">{</span><span class="n">xrange</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">3100</span><span class="p">,</span>
                                                                        <span class="mi">3100</span><span class="p">},</span>
                                                              <span class="n">yrange</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">}})</span>
<span class="kd">local</span> <span class="n">plot2</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">GnuplotSpectrumSink</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="s1">'AF Spectrum'</span><span class="p">,</span> <span class="p">{</span><span class="n">yrange</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">},</span>
                                                              <span class="n">xrange</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">},</span>
                                                              <span class="n">update_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">05</span><span class="p">})</span>

<span class="c1">-- Connections</span>
<span class="kd">local</span> <span class="n">top</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">CompositeBlock</span><span class="p">()</span>
<span class="n">top</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">tuner</span><span class="p">,</span> <span class="n">sb_filter</span><span class="p">,</span> <span class="n">am_demod</span><span class="p">,</span> <span class="n">af_filter</span><span class="p">,</span> <span class="n">af_gain</span><span class="p">,</span> <span class="n">sink</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s1">'DISPLAY'</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">top</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">tuner</span><span class="p">,</span> <span class="n">plot1</span><span class="p">)</span>
    <span class="n">top</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">af_gain</span><span class="p">,</span> <span class="n">plot2</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">top</span><span class="p">:</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<h5 id="usage">Usage</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Usage: examples/rtlsdr_ssb.lua &lt;frequency&gt; &lt;sideband&gt;
</code></pre></div></div>

<p>Running this example in a headless environment will inhibit plotting and record
audio to the WAV file <code class="language-plaintext highlighter-rouge">ssb.wav</code>.</p>

<h5 id="usage-example">Usage Example</h5>

<p>Listen to 3.745 MHz (with a 125 MHz upconverter), lower sideband:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./luaradio examples/rtlsdr_ssb.lua 128.745e6 lsb
</code></pre></div></div>


        <div class="footer">
          <div class="disclaimer">
  <p>
    Â© Vanya A. Sergeev, 2016-2020 &mdash; built with <a href="http://jekyllrb.com/">Jekyll</a>, theme based on <a href="https://github.com/swanson/lagom">Lagom</a>
  </p>
</div>

        </div>
      </div>
    </div>
  </div>
</body>
</html>
